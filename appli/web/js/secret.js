!function(e,t){var n=e.KonamiCode,o=e.KonamiCode=t;o.noConflict=function(){return e.KonamiCode=n,o},"function"==typeof define&&define.amd&&define(function(){return t}),"object"==typeof module&&module.exports&&(module.exports=t)}(this,function e(t){var n=this,o={},i=e;i.getNumberOfInstance=function(){return i._numberOfInstance},n.enable=function(){return o.listenCodeCharSequence(),o.listenCodeGestureSequence(),o.debug&&o.debug("Listener enabled for all."),n},n.enableKeyboardKeys=function(){return o.listenCodeCharSequence(),o.debug&&o.debug("Listener enabled for Keyboard Keys."),n},n.enableTouchGesture=function(){return o.listenCodeGestureSequence(),o.debug&&o.debug("Listener enabled for Touch Gesture."),n},n.disable=function(){return o.stopCodeCharSequence(),o.stopCodeGestureSequence(),o.debug&&o.debug("Listener disabled for all."),n},n.disableKeyboardKeys=function(){return o.stopCodeCharSequence(),o.debug&&o.debug("Listener disabled for Keyboard Keys."),n},n.disableTouchGesture=function(){return o.stopCodeGestureSequence(),o.debug&&o.debug("Listener disabled for Touch Gesture."),n},n.setListener=function(e){return o.stopCodeCharSequence(),o.stopCodeGestureSequence(),o.listener=e||document,o.listenCodeCharSequence(),o.listenCodeGestureSequence(),o.debug&&o.debug("Listener changed.",e),n},n.setCallback=function(e){return o.afterCodeSequenceCallback="function"==typeof e&&e||o.defaultCallback,o.debug&&o.debug("Callback changed.",e),n},n.setOptions=function(e){return o.initOptions(e),n},o.keptLastCodeChar=function(){o.input.length>o.konamiCodeChar.length&&(o.input=o.input.substr(o.input.length-o.konamiCodeChar.length))},o.defaultCallback=function(){o.debug&&o.debug("Konami Code Sequence Entered. There is no action defined.")},o.checkIfCodeCharIsValid=function(){o.input===o.konamiCodeChar&&o.afterCodeSequenceCallback(n)},o.codeSequenceEventKeyDown=function(e){o.input+=e.keyCode,o.keptLastCodeChar(),o.checkIfCodeCharIsValid()},o.codeSequenceEventTouchMove=function(e){var t;1===e.touches.length&&!0===o.capture&&(t=e.touches[0],o.stopX=t.pageX,o.stopY=t.pageY,o.tap=!1,o.capture=!1,o.checkIfCodeGestureIsValid())},o.codeSequenceEventTouchEnd=function(){!0===o.tap&&o.checkIfCodeGestureIsValid()},o.codeSequenceEventTouchStart=function(e){o.startX=e.changedTouches[0].pageX,o.startY=e.changedTouches[0].pageY,o.tap=!0,o.capture=!0},o.stopCodeCharSequence=function(){o.listener.removeEventListener("keydown",o.codeSequenceEventKeyDown)},o.stopCodeGestureSequence=function(){o.listener.removeEventListener("touchstart",o.codeSequenceEventTouchStart),o.listener.removeEventListener("touchmove",o.codeSequenceEventTouchMove),o.listener.removeEventListener("touchend",o.codeSequenceEventTouchEnd)},o.listenCodeCharSequence=function(){o.stopCodeCharSequence(),o.listener.addEventListener("keydown",o.codeSequenceEventKeyDown)},o.listenCodeGestureSequence=function(){o.originalCodeGesture=o.konamiCodeGesture,o.stopCodeGestureSequence(),o.listener.addEventListener("touchstart",o.codeSequenceEventTouchStart),o.listener.addEventListener("touchmove",o.codeSequenceEventTouchMove),o.listener.addEventListener("touchend",o.codeSequenceEventTouchEnd,!1)},o.checkIfCodeGestureIsValid=function(){var e=Math.abs(o.startX-o.stopX),t=Math.abs(o.startY-o.stopY),i=o.startX-o.stopX<0?"rt":"lt",a=o.startY-o.stopY<0?"dn":"up",r=e>t?i:a;(r=!0===o.tap?"tp":r)===o.konamiCodeGesture.substr(0,2)?o.konamiCodeGesture=o.konamiCodeGesture.substr(2,o.konamiCodeGesture.length-2):o.konamiCodeGesture=o.originalCodeGesture,0===o.konamiCodeGesture.length&&(o.konamiCodeGesture=o.originalCodeGesture,o.afterCodeSequenceCallback(n))},o.checkDebugMode=function(e){e&&!0===e.debug?(o.debug=function(e,t){void 0!==t?console.log(e,t):console.log(e)},o.debug&&o.debug("Debug Mode On.")):o.debug=!1},o.initOptions=function(e){o.checkDebugMode(e),o.listener=e&&e.listener||document,o.afterCodeSequenceCallback="function"==typeof e&&e||e&&"function"==typeof e.callback&&e.callback||o.defaultCallback},o.init=function(){o.input="",o.konamiCodeChar="38384040373937396665",o.konamiCodeGesture="upupdndnltrtltrttptp",o.startX=0,o.startY=0,o.stopX=0,o.stopY=0,o.tap=!1,o.capture=!1,i._numberOfInstance=i._numberOfInstance?i._numberOfInstance+1:1,o.initOptions(t),o.listenCodeCharSequence(),o.listenCodeGestureSequence()},o.init()});var kc=new KonamiCode({listener:document.getElementsByTagName("body")[0]});kc.setCallback(function(){kc.disable();function e(e){return document.getElementById(e)}function t(t,n){e(t).innerHTML=n}function n(){return(new Date).getTime()}function o(e,t){return e+Math.random()*(t-e)}document.write('<div id="tetris" style="font-size: 2.00em; width: 400px; margin: 1em auto; padding: 1em; border: 4px solid black; border-radius: 10px; background-color: #F8F8F8;"><div id="menu" style=" width: 200px; height: 400px;display: inline-block; vertical-align: top; position: relative; "><p  id="start" style="margin: 0.5em 0; text-align: center;display: inline-block; vertical-align: top; "><a href="javascript:play();" style="text-decoration: none; color: black; ">Press Space to Play.</a></p><p style="margin: 0.5em 0; text-align: center; "><canvas id="upcoming" style="width: 100px; height: 100px; display: block; margin: 0 auto; background-color: #E0E0E0;display: inline-block; vertical-align: top; box-shadow: 10px 10px 10px #999; border: 2px solid #333" ></canvas></p><p style="margin: 0.5em 0; text-align: center; ">score <span id="score" style="color: red; font-weight: bold; vertical-align: middle;">00000</span></p><p style="margin: 0.5em 0; text-align: center;color: blue; font-weight: bold; vertical-align: middle;  ">rows <span id="rows">0</span></p></div><canvas id="canvas" style="width: 200px; height: 400px; ">Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element</canvas></div>'),window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)});var i,a,r,s,c,l,d,u,p,f,g,h,b={ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},m={UP:0,RIGHT:1,DOWN:2,LEFT:3,MIN:0,MAX:3},y=new function(){function e(e,t,n){var o,i,a;for(i=0;i<30;i++)for(o=0;o<73;o++)e[a=4*(o+74*i)]=e[a+4],e[a+1]=e[a+5],e[a+2]=e[a+6];for(i=0;i<30;i++)a=4*(73+74*i),i<t?(e[a]=G[n].bg.r,e[a+1]=G[n].bg.g,e[a+2]=G[n].bg.b):(e[a]=G[n].fg.r,e[a+1]=G[n].fg.g,e[a+2]=G[n].fg.b)}var t,n,o,i,a,r,s,c,l,d,u,p,f,g,h=0,b=2,m=0,y=(new Date).getTime(),C=y,v=y,k=0,x=1e3,w=0,S=0,E=1e3,M=0,q=0,T=1e3,L=0,G={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};(t=document.createElement("div")).style.cursor="pointer",t.style.width="80px",t.style.opacity="0.9",t.style.zIndex="10001",t.addEventListener("click",function(){switch(++h==b&&(h=0),n.style.display="none",s.style.display="none",u.style.display="none",h){case 0:n.style.display="block";break;case 1:s.style.display="block";break;case 2:u.style.display="block"}},!1),(n=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(G.fps.bg.r/2)+","+Math.floor(G.fps.bg.g/2)+","+Math.floor(G.fps.bg.b/2)+")",n.style.padding="2px 0px 3px 0px",t.appendChild(n),(o=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",o.style.textAlign="left",o.style.fontSize="9px",o.style.color="rgb("+G.fps.fg.r+","+G.fps.fg.g+","+G.fps.fg.b+")",o.style.margin="0px 0px 1px 3px",o.innerHTML='<span style="font-weight:bold">FPS</span>',n.appendChild(o),(i=document.createElement("canvas")).width=74,i.height=30,i.style.display="block",i.style.marginLeft="3px",n.appendChild(i),(a=i.getContext("2d")).fillStyle="rgb("+G.fps.bg.r+","+G.fps.bg.g+","+G.fps.bg.b+")",a.fillRect(0,0,i.width,i.height),r=a.getImageData(0,0,i.width,i.height),(s=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(G.ms.bg.r/2)+","+Math.floor(G.ms.bg.g/2)+","+Math.floor(G.ms.bg.b/2)+")",s.style.padding="2px 0px 3px 0px",s.style.display="none",t.appendChild(s),(c=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",c.style.textAlign="left",c.style.fontSize="9px",c.style.color="rgb("+G.ms.fg.r+","+G.ms.fg.g+","+G.ms.fg.b+")",c.style.margin="0px 0px 1px 3px",c.innerHTML='<span style="font-weight:bold">MS</span>',s.appendChild(c),(i=document.createElement("canvas")).width=74,i.height=30,i.style.display="block",i.style.marginLeft="3px",s.appendChild(i),(l=i.getContext("2d")).fillStyle="rgb("+G.ms.bg.r+","+G.ms.bg.g+","+G.ms.bg.b+")",l.fillRect(0,0,i.width,i.height),d=l.getImageData(0,0,i.width,i.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(b=3)}catch(e){}return(u=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(G.mb.bg.r/2)+","+Math.floor(G.mb.bg.g/2)+","+Math.floor(G.mb.bg.b/2)+")",u.style.padding="2px 0px 3px 0px",u.style.display="none",t.appendChild(u),(p=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",p.style.textAlign="left",p.style.fontSize="9px",p.style.color="rgb("+G.mb.fg.r+","+G.mb.fg.g+","+G.mb.fg.b+")",p.style.margin="0px 0px 1px 3px",p.innerHTML='<span style="font-weight:bold">MB</span>',u.appendChild(p),(i=document.createElement("canvas")).width=74,i.height=30,i.style.display="block",i.style.marginLeft="3px",u.appendChild(i),(f=i.getContext("2d")).fillStyle="#301010",f.fillRect(0,0,i.width,i.height),g=f.getImageData(0,0,i.width,i.height),{domElement:t,update:function(){m++,y=(new Date).getTime(),S=y-C,E=Math.min(E,S),M=Math.max(M,S),e(d.data,Math.min(30,30-S/200*30),"ms"),c.innerHTML='<span style="font-weight:bold">'+S+" MS</span> ("+E+"-"+M+")",l.putImageData(d,0,0),C=y,y>v+1e3&&(k=Math.round(1e3*m/(y-v)),x=Math.min(x,k),w=Math.max(w,k),e(r.data,Math.min(30,30-k/100*30),"fps"),o.innerHTML='<span style="font-weight:bold">'+k+" FPS</span> ("+x+"-"+w+")",a.putImageData(r,0,0),3==b&&(q=9.54e-7*performance.memory.usedJSHeapSize,T=Math.min(T,q),L=Math.max(L,q),e(g.data,Math.min(30,30-q/2),"mb"),p.innerHTML='<span style="font-weight:bold">'+Math.round(q)+" MB</span> ("+Math.round(T)+"-"+Math.round(L)+")",f.putImageData(g,0,0)),v=y,m=0)}}},C=e("canvas"),v=C.getContext("2d"),k=e("upcoming"),x=k.getContext("2d"),w={start:.6,decrement:.005,min:.1},S=10,E=20,M=5,q={size:4,blocks:[3840,8738,240,17476],color:"cyan"},T={size:3,blocks:[17600,36352,25664,3616],color:"blue"},L={size:3,blocks:[17504,3712,50240,11776],color:"orange"},G={size:2,blocks:[52224,52224,52224,52224],color:"yellow"},I={size:3,blocks:[1728,35904,27648,17952],color:"green"},D={size:3,blocks:[3648,19520,19968,17984],color:"purple"},F={size:3,blocks:[3168,19584,50688,9792],color:"red"};function H(e,t,n,o,i){var a,r=0,s=0,c=e.blocks[o];for(a=32768;a>0;a>>=1)c&a&&i(t+s,n+r),4==++s&&(s=0,++r)}function R(e,t,n,o){var i=!1;return H(e,t,n,o,function(e,t){(e<0||e>=S||t<0||t>=E||V(e,t))&&(i=!0)}),i}function z(e,t,n,o){return!R(e,t,n,o)}var A=[];function O(){0==A.length&&(A=[q,q,q,q,T,T,T,T,L,L,L,L,G,G,G,G,I,I,I,I,D,D,D,D,F,F,F,F]);var e=A.splice(o(0,A.length-1),1)[0];return{type:e,dir:m.UP,x:Math.round(o(0,S-e.size)),y:0}}function K(e){C.width=C.clientWidth,C.height=C.clientHeight,k.width=k.clientWidth,k.height=k.clientHeight,i=C.width/S,a=C.height/E,ne(),oe()}function P(t){var n=!1;if(c)switch(t.keyCode){case b.LEFT:s.push(m.LEFT),n=!0;break;case b.RIGHT:s.push(m.RIGHT),n=!0;break;case b.UP:s.push(m.UP),n=!0;break;case b.DOWN:s.push(m.DOWN),n=!0;break;case b.ESC:X(),n=!0}else t.keyCode==b.SPACE&&(e("start").style.visibility="hidden",Q(),c=!0,n=!0);n&&t.preventDefault()}function X(){e("start").style.visibility=null,N(),c=!1}function N(e){f=e||p,te.score=!0}function W(e){p+=e}function Y(){var e;p=e=0,N(e)}function U(e){g=e,h=Math.max(w.min,w.start-w.decrement*g),te.rows=!0}function V(e,t){return r&&r[e]?r[e][t]:null}function B(e,t,n){r[e]=r[e]||[],r[e][t]=n,ne()}function _(){s=[]}function j(e){d=e||O(),ne()}function J(e){u=e||O(),oe()}function Q(){l=0,_(),r=[],ne(),U(0),Y(),j(u),J()}function Z(e){var t=d.x,n=d.y;switch(e){case m.RIGHT:t+=1;break;case m.LEFT:t-=1;break;case m.DOWN:n+=1}return!!z(d.type,t,n,d.dir)&&(d.x=t,d.y=n,ne(),!0)}function $(){Z(m.DOWN)||(W(10),H(d.type,d.x,d.y,d.dir,function(e,t){B(e,t,d.type)}),function(){var e,t,n,o=0;for(t=E;t>0;--t){for(n=!0,e=0;e<S;++e)V(e,t)||(n=!1);n&&(ee(t),t+=1,o++)}o>0&&(!function(e){U(g+e)}(o),W(100*Math.pow(2,o-1)))}(),j(u),J(O()),_(),R(d.type,d.x,d.y,d.dir)&&X())}function ee(e){var t,n;for(n=e;n>=0;--n)for(t=0;t<S;++t)B(t,n,0==n?null:V(t,n-1))}var te={};function ne(){te.court=!0}function oe(){te.next=!0}function ie(e,t,n,o,i){H(t,n,o,i,function(n,o){ae(e,n,o,t.color)})}function ae(e,t,n,o){e.fillStyle=o,e.fillRect(t*i,n*a,i,a),e.strokeRect(t*i,n*a,i,a)}!function(){y.domElement.id="stats",e("menu").appendChild(y.domElement),document.addEventListener("keydown",P,!1),window.addEventListener("resize",K,!1);var o=now=n();K(),Q(),function e(){var r;now=n(),r=Math.min(1,(now-o)/1e3),c&&(f<p&&N(f+1),function(e){switch(e){case m.LEFT:Z(m.LEFT);break;case m.RIGHT:Z(m.RIGHT);break;case m.UP:t=d.dir==m.MAX?m.MIN:d.dir+1,z(d.type,d.x,d.y,t)&&(d.dir=t,ne());break;case m.DOWN:$()}var t}(s.shift()),(l+=r)>h&&(l-=h,$())),v.save(),v.lineWidth=1,v.translate(.5,.5),function(){if(te.court){var e,t,n;for(v.clearRect(0,0,C.width,C.height),c&&ie(v,d.type,d.x,d.y,d.dir),t=0;t<E;t++)for(e=0;e<S;e++)(n=V(e,t))&&ae(v,e,t,n.color);v.strokeRect(0,0,S*i-1,E*a-1),te.court=!1}}(),function(){if(te.next){var e=(M-u.type.size)/2;x.save(),x.translate(.5,.5),x.clearRect(0,0,M*i,M*a),ie(x,u.type,e,e,u.dir),x.strokeStyle="black",x.strokeRect(0,0,M*i-1,M*a-1),x.restore(),te.next=!1}}(),te.score&&(t("score",("00000"+Math.floor(f)).slice(-5)),te.score=!1),te.rows&&(t("rows",g),te.rows=!1),v.restore(),y.update(),o=now,requestAnimationFrame(e,C)}()}()});